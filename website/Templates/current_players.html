{% extends "base.html" %}
{% block title %} Current Players {% endblock %}
{% block content %}
<br>
<p>
    Here is the current list of players that will be used to create the groups.
    <br>
    <br>
    Once all players are signed up hit the "Create Groups!" button at the bottom.
</p>


<div class="rounded border border-1 shadow bg-primary-subtle p-4">
<h2 class="h2" align="center">
    Currently Signed Up Players
</h2>

<form method="POST" name="is_active_form" id="is_active_form"  action="{{url_for('views.create_groups') }}">


<table class="table table-striped table-hover">
    <thead>
    <tr>
        <th>Delete Player</th>
        <th>Player name</th>
        <th>Character name</th>
        <th>Class</th>
        <th>Role</th>
        <th>Range</th>
        <th>Skill Level</th>
        <th>Dungeon</th>
        <th>Key Level</th>
        <th>Delete Character</th>
        <th>Selected</th>
    </tr>
    </thead>
    <tbody>

        {% for player, characters in playersListDB.items() %}

        <tr>

            <td rowspan="{{ characters|length }}">
                <form method="POST" name="my_form">
                    <input type="hidden" name="playerName" value="{{ player }}">
                    <button type="submit" >Delete</button>
                </form>
            </td>
            <td rowspan="{{ characters|length }}">{{ player }}</td>

                {% for k,v in characters.items() %}
                {% if loop.first %}
                    <td>{{ k }}</td>
                    <td>{{ v['Class'] }}</td>
                    <td>{{ v['Role']|join(', ') }}</td>
                    <td>{{ v['Range'] }}</td>
                    <td>{{ v['Skill Level'] }}</td>
                    <td>{{ v['Dungeon'] }}</td>
                    <td>{{ v['Key Level'] }}</td>
                    <td>
                        <form method="POST" name="my_form"> 
                            <input type="hidden" name="characterName" value="{{ k }}">
                            <button type="submit" >Delete</button>
                        </form>
                        <form method="POST" name="my_form" action="{{ url_for('views.edit_entry') }}"> 
                            <input type="hidden" name="characterName" value="{{ k }}">
                            <button type="submit" >Edit</button>
                        </form>                        
                    </td>
                    <td><div class="form-check">
                        <input class="form-check-input" type="checkbox" value="{{k}}" id="flexCheckChecked_{{k}}" name="is_active_{{k}}" form="is_active_form" checked>
                        <label class="form-check-label" for="flexCheckChecked_{{k}}">
                          Checked checkbox for {{k}}
                        </label>
                      </div></td> 
        </tr>
            {% else %}
            <tr>
                <td>{{ k }}</td>
                <td>{{ v['Class'] }}</td>
                <td>{{ v['Role']|join(', ') }}</td>
                <td>{{ v['Range'] }}</td>
                <td>{{ v['Skill Level'] }}</td>
                <td>{{ v['Dungeon'] }}</td>
                <td>{{ v['Key Level'] }}</td>
                <td>
                    <form method="POST" name="my_form"> 
                        <input type="hidden" name="characterName" value="{{ k }}">
                        <button type="submit" >Delete</button>
                    </form>
                    <form method="POST" name="my_form" action="{{ url_for('views.edit_entry') }}"> 
                        <input type="hidden" name="characterName" value="{{ k }}">
                        <button type="submit" >Edit</button>
                    </form>
                </td>
                <td><div class="form-check">
                    <input class="form-check-input" type="checkbox" value="{{k}}" id="flexCheckChecked_{{k}}" name="is_active_{{k}}" form="is_active_form" checked>
                    <label class="form-check-label" for="flexCheckChecked_{{k}}">
                      Checked checkbox for {{k}}
                    </label>
                  </div></td> 
                {% endif %} 

            </tr>
            {% endfor %}



        {% endfor %}


        <tfoot>
            <tr>
                <th>Total</th>
                <!-- get grand total //-->
                <th>{{totalplayers}}</th>
            </tr>
        </tfoot>
    </tbody>   

</table>

<div align="center">
    <br>
    <br>
    <input type="submit" value="is_active_form" form="is_active_form">
    <button type="submit"> Submit </button>
</div>
</form>

</div>
<script>
    let elements = document.getElementsByClassName("is_asctive")
    for (elem of elements) {
        elem.addEventListener("click", function() {
            console.log("eventlistener added for ", elem)
        })
    }
    
    if (isActive.target.checked) {
        console.log("checkbox is checked")
    } else {
        console.log("checkbox is unchecked")
    }
    

    function toggleRadioButtons(event) {
        // Get the checkbox
        var checkbox = event.target;
        var roleButton = checkbox.id;
        var newName = `combat_role_${roleButton}`;
        var skillname = `${roleButton}-skill`;

        // Get all radio buttons
        var radioButtons = document.querySelectorAll(`input[type="radio"][name="${newName}"]`);
        var skillslider = document.querySelectorAll(`input[type="range"][name="${skillname}"]`);
        console.log(radioButtons);
        console.log(skillslider);

        // Enable or disable radio buttons based on checkbox state
        radioButtons.forEach(function(radio) {
            radio.disabled = !checkbox.checked;
            radio.required = checkbox.checked;
        });
        // Enable or disable skill slider based on checkbox state
        skillslider.forEach(function(slider) {
            slider.disabled = !checkbox.checked;
        })
    }

    // Attach event listener to checkbox
    document.getElementById('tank').addEventListener('change', toggleRadioButtons);
    document.getElementById('healer').addEventListener('change', toggleRadioButtons);
    document.getElementById('dps').addEventListener('change', toggleRadioButtons);
</script>


{% endblock %}